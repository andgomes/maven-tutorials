<!DOCTYPE html>

<html>
	<head>
		<title>Agregando Projetos</title>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	</head>
	<body>
		<h1>Agregando Projetos</h1>
		
		<p>
		Em sistemas muito grandes e complexos, a solução para diminuir essa
		complexidade muitas vezes é a modularização. Além disso, um projeto pode
		depender de módulos desenvolvidos por outra equipe ou instituição.
		Em projetos Maven que precisam ser divididos em módulos, podemos
		utilizar uma feature chamada de agregação. Com a agregação, podemos
		declarar quais são os módulos dos quais nosso projeto é composto. Dessa
		forma, podemos fazer o build de todas as partes do projeto apenas
		executando o comando no projeto agregador.
		</p>
		
		<p>
		Como exemplo, vamos criar um diretório chamado aggregating-project e
		criar o arquivo pom.xml do projeto agregador dentro deste diretório. É
		nesse arquivo POM que iremos definir quais são os módulos do nosso
		projeto.
		</p>
		
		<p>
		&lt;?xml version="1.0" encoding="UTF-8"?&gt; <br />
		&lt;project xmlns="http://maven.apache.org/POM/4.0.0" <br />
		---------xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" <br />
		---------xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 <br />
		---------http://maven.apache.org/maven-v4_0_0.xsd"&gt; <br />
		--&lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; <br />
		--&lt;groupId&gt;org.andgomes&lt;/groupId&gt; <br />
		--&lt;artifactId&gt;aggregate-project&lt;/artifactId&gt; <br />
		--&lt;packaging&gt;pom&lt;/packaging&gt; <br />
		--&lt;version&gt;0.0.1&lt;/version&gt; <br />
		--&lt;modules&gt; <br />
		----&lt;module&gt;module-project&lt;/module&gt; <br />
		--&lt;/modules&gt; <br />
		&lt;/project&gt;
		</p>
		
		<p>
		Em projetos agregadores, o packaging obrigatoriamente deve ser do tipo
		POM. Isso faz sentido porque o objetivo de um projeto agregador é
		simplesmente declarar quais são os módulos que compõem a aplicação. É na
		seção modules que declaramos os artifactIds desses módulos. No nosso
		exemplo, como vamos criar apenas um módulo, só adicionamos um module com
		o artifactId module-project.
		</p>
		
		<p>
		Agora precisamos criar o projeto module-project, que é referenciado pelo
		arquivo POM do projeto agregador. É importante dizer que, da forma como
		declaramos o módulo no arquivo POM acima, o diretório do projeto
		module-project precisa estar dentro do diretório aggregating-project.
		Mais à frente veremos como contornar essa restrição.
		</p>
		
		<p>
		Dito isso, vamos entrar no diretório aggregating-project e utilizar o já
		conhecido archetype quickstart para criar o projeto module-project.
		</p>
		
		<p>
		$ cd aggregating-project <br />
		$ mvn archetype:generate -DgroupId=org.andgomes
		-DartifactId=module-project
		-DarchetypeArtifactId=maven-archetype-quickstart -DinteractiveMode=false
		</p>
		
		<p>
		Depois de criado o projeto, o diretório aggregating-project deve ter a
		seguinte estrutura:
		</p>
		
		<p>
		pom.xml <br />
		module-project/ <br />
		|--src/ <br />
		|--|--main/java/org/andgomes/App.java <br />
		|--|--test/java/org/andgomes/AppTest.java <br />
		|--pom.xml
		</p>
		
		<p>
		Agora que temos o projeto agregador e o módulo criados, vamos executar
		um comando de build e verificar o resultado. Como foi dito no início
		do post, se executarmos um comando de build no projeto agregador, o
		efeito será o mesmo de executar esse comando simultaneamente em todos os
		módulos. Como exemplo, vamos invocar a fase compile.
		</p>
		
		<p>
		$ mvn compile
		</p>
		
		<p>
		Durante o processamento do build, o Maven irá mostrar a ordem de
		execução dos projetos através de um mecanismo chamado Reactor. A função
		do Reactor é fazer o escalonamento dos módulos de forma que, se um
		módulo X depende de um módulo Y, o módulo Y é processado primeiro. Como
		nosso projeto só tem um módulo, o trabalho do Reactor aqui é fácil.
		</p>
		
		<p>
		[INFO] Reactor Build Order: <br />
		[INFO] <br />
		[INFO] aggregate-project <br />
		[INFO] module-project
		</p>
		
		<p>
		Se a fase foi concluída normalmente, o diretório aggregating-project
		deve ter resultado na seguinte estrutura.
		</p>
		
		<p>
		pom.xml <br />
		module-project/ <br />
		|--src/ <br />
		|--|--main/java/org/andgomes/App.java <br />
		|--|--test/java/org/andgomes/AppTest.java <br />
		|--target/
		|--|--classes/
		|--|--maven-status/
		|--pom.xml
		</p>
		
		<p>
		Como esperado, mesmo tendo invocado a fase compile no diretório
		aggregating-project, o efeito foi o mesmo de termos executado o comando
		no module-project.
		</p>
	</body>
</html>
